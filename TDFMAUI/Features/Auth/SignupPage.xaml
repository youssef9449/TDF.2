<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TDFMAUI.Features.Auth"
             xmlns:converters="clr-namespace:TDFMAUI.Converters"
             xmlns:helpers="clr-namespace:TDFMAUI.Helpers"
             x:Class="TDFMAUI.Features.Auth.SignupPage"
             x:DataType="vm:SignupViewModel"
             Title="Sign Up">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ValidationStateToColorConverter x:Key="ValidationStateToColorConverter"/>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <ScrollView>
            <Grid HorizontalOptions="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <VerticalStackLayout Spacing="20" Padding="20" WidthRequest="500">
                    <!-- Header -->
                    <Label Text="Create Account"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           Margin="0,10,0,20"/>

                    <!-- Form Fields -->
                    <VerticalStackLayout Spacing="15">
                        <!-- Username -->
                        <VerticalStackLayout>
                            <Label Text="Username" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Entry Text="{Binding Username}"
                                       Placeholder="Enter username"
                                       FontSize="16"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Full Name -->
                        <VerticalStackLayout>
                            <Label Text="Full Name" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Entry Text="{Binding FullName}"
                                       Placeholder="Enter full name"
                                       FontSize="16"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Password -->
                        <VerticalStackLayout>
                            <Label Text="Password" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Entry Text="{Binding Password}"
                                       Placeholder="Enter password"
                                       IsPassword="True"
                                       FontSize="16"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Confirm Password -->
                        <VerticalStackLayout>
                            <Label Text="Confirm Password" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Entry Text="{Binding ConfirmPassword}"
                                       Placeholder="Confirm password"
                                       IsPassword="True"
                                       FontSize="16"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Department -->
                        <VerticalStackLayout>
                            <Label Text="Department" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   HorizontalOptions="Fill">
                                <Picker Title="Select Department"
                                        ItemsSource="{Binding Departments}"
                                        SelectedItem="{Binding SelectedDepartment}"
                                        ItemDisplayBinding="{Binding Name}"
                                        FontSize="16"
                                        HeightRequest="70"
                                        WidthRequest="450"
                                        HorizontalOptions="Fill"/>
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Title -->
                        <VerticalStackLayout>
                            <Label Text="Title" FontSize="16"/>
                            <Frame BorderColor="{Binding HasError, Converter={StaticResource ValidationStateToColorConverter}}"
                                   Padding="10"
                                   CornerRadius="8"
                                   HasShadow="False"
                                   HorizontalOptions="Fill">
                                <Picker Title="Select Title"
                                        ItemsSource="{Binding Titles}"
                                        SelectedItem="{Binding SelectedTitle}"
                                        FontSize="16"
                                        HeightRequest="70"
                                        WidthRequest="450"
                                        HorizontalOptions="Fill"/>
                            </Frame>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Error Message -->
                    <Frame IsVisible="{Binding HasError}"
                           BackgroundColor="#FFEBEE"
                           BorderColor="#EF5350"
                           Padding="10"
                           CornerRadius="8"
                           Margin="0,10,0,0">
                        <Label Text="{Binding ErrorMessage}"
                               TextColor="#B71C1C"
                               FontSize="14"
                               HorizontalOptions="Center"/>
                    </Frame>

                    <!-- Sign Up Button -->
                    <Button Text="Sign Up"
                            Command="{Binding SignupCommand}"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            FontSize="16"
                            HeightRequest="50"
                            CornerRadius="25"
                            Margin="0,20,0,0"/>

                    <!-- Login Link -->
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="5">
                        <Label Text="Already have an account?"
                               FontSize="14"
                               TextColor="Gray"/>
                        <Label Text="Login"
                               FontSize="14"
                               TextColor="#2196F3">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoToLoginCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>